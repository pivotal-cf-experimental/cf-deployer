#!/usr/bin/env ruby
# vim: ft=ruby

require "cf_deployer/command_runner"
require "cf_deployer/logger"

require "canary_breeder/breed_canaries_cli"
require "canary_breeder/canary_breeder"

cli = CanaryBreeder::Cli.new(ARGV)

cf_deploy = CanaryBreeder::Breeder.new(cli.parse!)

logger = CfDeployer::Logger.new(`tput cols`.to_i)

begin
  options = cli.parse!
  cli.validate!

  runner = CfDeployer::CommandRunner.new(logger, options.dry_run)

  cf_deploy.breed(logger, runner)
rescue => e
  logger.log_exception e
  exit 1
end
