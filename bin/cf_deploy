#!/usr/bin/env ruby
# vim: ft=ruby

require "cf_deployer/cf_deploy"
require "cf_deployer/command_runner"
require "cf_deployer/logger"

logger = CfDeployer::Logger.new(`tput cols`.to_i)

cf_deploy = CfDeployer::CfDeploy.new(logger, CfDeployer::Cli.new(ARGV).parse!)
runner = CfDeployer::CommandRunner.new(logger)

begin
  Bundler.with_clean_env do
    cf_deploy.deploy("aws", runner)
  end
rescue => e
  logger.log_exception e
  exit 1
end
