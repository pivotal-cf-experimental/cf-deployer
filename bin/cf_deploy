#!/usr/bin/env ruby
# vim: ft=ruby

require "cf_deployer/cf_deploy"
require "cf_deployer/options_parser"
require "cf_deployer/logger"
require "cf_deployer/deploy_environment"

begin
  options_parser = CfDeployer::OptionsParser.new(ARGV)
  options = options_parser.parse!
  options_parser.validate!

  deploy_env = CfDeployer::DeployEnvironment.new(options)
  deploy_env.prepare
  cf_deploy = CfDeployer::CfDeploy.new(deploy_env)
  cf_deploy.create_release
  cf_deploy.upload_release
  cf_deploy.deploy_release
  cf_deploy.promote_release
rescue => e
  CfDeployer::Logger.new.log_exception e
  exit 1
end
