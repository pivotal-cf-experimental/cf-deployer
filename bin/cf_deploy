#!/usr/bin/env ruby
# vim: ft=ruby

require "cf_deployer/cf_deploy"
require "cf_deployer/cli"
require "cf_deployer/logger"
require "cf_deployer/deploy_environment"

cli = CfDeployer::Cli.new(ARGV)

logger = CfDeployer::Logger.new(`tput cols`.to_i)

begin
  options = cli.parse!
  cli.validate!
  deploy_env = CfDeployer::DeployEnvironment.new(options, logger)
  CfDeployer::CfDeploy.new(deploy_env, logger).create_final_release_and_deploy!
rescue => e
  logger.log_exception e
  exit 1
end
